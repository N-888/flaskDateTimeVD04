"""
app.py - Главный файл приложения FlaskDateTimeVD04
Приложение для стильного отображения текущей даты и времени в реальном времени
"""

# Импорт модуля flask - это основной фреймворк для веб-приложений на Python
# Flask предоставляет инструменты для создания веб-сервера, маршрутизации и работы с шаблонами
from flask import Flask, render_template, jsonify
# Импорт функции datetime из модуля datetime
# Позволяет работать с датами и временем в Python
from datetime import datetime
# Импорт модуля pytz для работы с часовыми поясами
# Обеспечивает корректное отображение времени в разных регионах мира
import pytz

# Создание экземпляра класса Flask - это основная точка входа приложения
# Параметр __name__ сообщает Flask, где искать ресурсы (шаблоны, статические файлы)
# Flask использует это значение для определения корневой папки приложения
app = Flask(__name__)

# Определение константы TIMEZONE, которая хранит строку с названием часового пояса
# pytz использует имена часовых поясов в формате "Регион/Город"
# 'Europe/Moscow' соответствует московскому времени (МСК, UTC+3)
# Можно изменить на другой часовой пояс, например:
# 'America/New_York' - Нью-Йорк, 'Asia/Tokyo' - Токио, 'Europe/London' - Лондон
TIMEZONE = 'Europe/Moscow'


# Декоратор @app.route() определяет URL-маршрут для обработки запросов
# '/' означает корневой URL (например: http://localhost:5000/)
# Когда пользователь открывает главную страницу, Flask вызывает функцию index()
@app.route('/')
def index():
    """
    Обработчик главной страницы приложения.
    Эта функция выполняется при открытии корневого URL.
    Она собирает данные о текущем времени и передает их в HTML шаблон.
    """

    # Создание объекта часового пояса на основе строки TIMEZONE
    # pytz.timezone() возвращает объект часового пояса, который можно использовать для преобразования времени
    tz = pytz.timezone(TIMEZONE)

    # Получение текущей даты и времени в указанном часовом поясе
    # datetime.now(tz) возвращает объект datetime с текущим временем в заданном часовом поясе
    now = datetime.now(tz)

    # Форматирование времени в строку с использованием метода strftime()
    # %H - часы в 24-часовом формате (00-23)
    # %M - минуты (00-59)
    # %S - секунды (00-59)
    # Результат: "14:30:45"
    current_time = now.strftime("%H:%M:%S")

    # Форматирование даты в читаемый вид
    # %d - день месяца с ведущим нулем (01-31)
    # %B - полное название месяца (например: "Январь")
    # %Y - год с веком (например: "2024")
    # Результат: "01 января 2024"
    current_date = now.strftime("%d %B %Y")

    # Получение дня недели
    # %A - полное название дня недели (например: "Понедельник")
    current_weekday = now.strftime("%A")

    # Дополнительные форматы времени для различных вариантов отображения

    # Время в 24-часовом формате без секунд
    # %H - часы (00-23), %M - минуты (00-59)
    time_24h = now.strftime("%H:%M")

    # Время в 12-часовом формате с AM/PM обозначением
    # %I - часы в 12-часовом формате (01-12)
    # %M - минуты (00-59)
    # %p - AM/PM обозначение
    time_12h = now.strftime("%I:%M %p")

    # Короткая дата в формате день/месяц/год
    # %d - день (01-31), %m - месяц (01-12), %Y - год (2024)
    date_short = now.strftime("%d/%m/%Y")

    # Дата в международном ISO формате (год-месяц-день)
    # Используется в базах данных и для сортировки
    iso_date = now.strftime("%Y-%m-%d")

    # Разделение даты на компоненты для детального отображения
    # Эти значения используются для отображения в отдельных блоках на странице
    hour = now.hour  # Часы как число (0-23)
    minute = now.minute  # Минуты как число (0-59)
    second = now.second  # Секунды как число (0-59)
    day = now.day  # День месяца как число (1-31)
    month = now.month  # Месяц как число (1-12)
    year = now.year  # Год как число (например: 2024)

    # Unix timestamp - количество секунд с 1 января 1970 года
    # Используется в компьютерных системах для хранения времени
    timestamp = int(now.timestamp())

    # Функция render_template() загружает HTML шаблон и заполняет его данными
    # 'index.html' - имя файла шаблона в папке templates/
    # После имени шаблона передаются именованные аргументы с данными для шаблона
    # Flask подставит эти значения в соответствующие места в HTML коде
    return render_template(
        'index.html',

        # Основные данные для отображения
        time=current_time,  # Текущее время в формате "ЧЧ:ММ:СС"
        date=current_date,  # Текущая дата в формате "день месяц год"
        weekday=current_weekday,  # День недели
        timezone=TIMEZONE,  # Название часового пояса

        # Дополнительные форматы времени и даты
        time_24h=time_24h,  # Время без секунд
        time_12h=time_12h,  # Время в 12-часовом формате
        date_short=date_short,  # Дата в коротком формате
        iso_date=iso_date,  # Дата в ISO формате

        # Детализированные компоненты даты и времени
        hour=hour,  # Часы как число
        minute=minute,  # Минуты как число
        second=second,  # Секунды как число
        day=day,  # День месяца как число
        month=month,  # Месяц как число
        year=year,  # Год как число

        # Технические данные
        timestamp=timestamp  # Unix timestamp
    )


# Маршрут для API, который возвращает текущее время в формате JSON
# Используется для AJAX-запросов с фронтенда без перезагрузки страницы
@app.route('/api/current_time')
def api_current_time():
    """
    API endpoint для получения текущего времени в формате JSON.
    Этот маршрут используется JavaScript кодом для обновления времени без перезагрузки страницы.
    Возвращает данные в стандартном JSON формате, который легко обрабатывать на клиенте.
    """

    # Повторяем те же шаги для получения текущего времени
    # Это необходимо, так как функция вызывается отдельно от главной страницы
    tz = pytz.timezone(TIMEZONE)
    now = datetime.now(tz)

    # Функция jsonify() преобразует Python словарь в JSON ответ с правильными HTTP заголовками
    # JSON (JavaScript Object Notation) - стандартный формат для обмена данными между клиентом и сервером
    return jsonify({
        'time': now.strftime("%H:%M:%S"),  # Время в формате "ЧЧ:ММ:СС"
        'date': now.strftime("%d %B %Y"),  # Дата в полном формате
        'weekday': now.strftime("%A"),  # День недели
        'timezone': TIMEZONE,  # Часовой пояс
        'timestamp': int(now.timestamp()),  # Unix timestamp
        'iso': now.isoformat(),  # Дата и время в международном ISO формате
        'status': 'success',  # Статус выполнения запроса
        'message': 'Time data retrieved successfully'  # Сообщение об успешном выполнении
    })


# Маршрут для проверки здоровья приложения (health check)
# Используется системами мониторинга для проверки работоспособности сервиса
@app.route('/health')
def health_check():
    """
    Endpoint для проверки работоспособности приложения.
    Системы мониторинга (как внешние, так и внутренние) периодически обращаются к этому URL
    чтобы убедиться, что приложение работает корректно.
    """

    # Возвращаем простой JSON с информацией о состоянии приложения
    return jsonify({
        'status': 'healthy',  # Статус приложения (healthy/unhealthy)
        'service': 'Flask DateTime App VD04',  # Название сервиса
        'version': '1.0.0',  # Версия приложения
        'timestamp': datetime.now().isoformat(),  # Время проверки в ISO формате
        'timezone': TIMEZONE,  # Используемый часовой пояс
        'environment': 'development' if app.debug else 'production'  # Режим работы
    })


# Маршрут для получения информации о приложении
@app.route('/about')
def about():
    """
    Страница с информацией о приложении.
    Показывает технические детали, версию и описание функционала.
    """

    return jsonify({
        'application': 'Flask DateTime Display VD04',
        'description': 'Приложение для стильного отображения текущей даты и времени',
        'version': '1.0.0',
        'author': 'Flask Developer',
        'features': [
            'Отображение текущего времени в реальном времени',
            'Поддержка различных форматов даты и времени',
            'Автоматическое обновление каждую секунду',
            'API для программного доступа к данным о времени',
            'Адаптивный дизайн для всех устройств'
        ],
        'technologies': ['Flask', 'Python', 'HTML5', 'CSS3', 'JavaScript'],
        'endpoints': {
            '/': 'Главная страница с интерфейсом',
            '/api/current_time': 'API для получения текущего времени',
            '/health': 'Проверка работоспособности',
            '/about': 'Эта страница с информацией'
        }
    })


# Условный блок, который проверяет, запущен ли этот файл напрямую
# Если файл импортируется как модуль, этот код не выполняется
# Это стандартная практика в Python для отделения кода запуска от кода модуля
if __name__ == '__main__':
    """
    Точка входа при запуске приложения напрямую.
    Этот код выполняется только когда мы запускаем файл командой: python app.py
    """

    # Метод run() запускает встроенный веб-сервер Flask для разработки
    # Параметры запуска:

    # debug=True - Включает режим отладки:
    #   • Автоматическая перезагрузка сервера при изменении кода
    #   • Детальные сообщения об ошибках в браузере
    #   • Интерактивный отладчик для ошибок 500
    # В продакшене всегда устанавливайте debug=False!

    # port=5000 - Порт, на котором будет работать сервер:
    #   • 5000 - стандартный порт для Flask приложений
    #   • Можно изменить на другой, если порт занят

    # host='0.0.0.0' - Хост, на котором будет слушать сервер:
    #   • '0.0.0.0' означает "все доступные сетевые интерфейсы"
    #   • Позволяет получать доступ к серверу из других устройств в сети
    #   • По умолчанию Flask слушает только локальные подключения (127.0.0.1)

    app.run(
        debug=True,  # Режим отладки (включен для разработки)
        port=5000,  # Порт приложения
        host='0.0.0.0'  # Хост для доступа из сети (опционально)
    )